<import src="../../wxParse/wxParse.wxml"></import>
<import src="../template/template.wxml" />
<scroll-view bindscroll="scroll" scroll-top="{{scrollTop}}" scroll-y="true" style="position:absolute; top:0; left:0; right:0; bottom:0;">
  <view class="container" wx:if="{{detail.goods_id}}">

    <template is="swiper" data="{{imgUrls:detail.image,current:current,height:750}}"></template>

    <view class="cont-box b-f">
      <view class="dis-flex flex-y-center">
        <view class="left flex-box dis-flex flex-dir-column">
          <!-- 商品名称 -->
          <view class="goods-title ">
            <text class="title fo-36 bold twolist-hidden">{{detail.goods_name}}</text>
          </view>
          <!-- 商品卖点 -->
          <view class="ma-t10">
            <text class="fo-28 fo-g">{{ detail.selling_point }}</text>
          </view>
          <view class="money-box">
            <text class=" f-26 fo-b7">￥</text>
            <text class="price fo-36 bold ma-t10 fo-b7">{{goods_price}}</text>
            <text class="del" wx:if="{{line_price>0}}">￥{{line_price}}</text>
          </view>
        </view>
        <view class="right goods__share">
          <form bindsubmit="openActionsheet" report-submit="true">
            <button formType="submit" class="share-btn dis-flex flex-dir-column">
              <text class="share__icon iconfont icon-fenxiang"></text>
              <text class="f-24">分享</text>
            </button>
          </form>
        </view>
      </view>
      <view class="goods-sales-box f-28 dis-flex col-8">
        <text class="flex-box num">销量：{{detail.goods_sales}}</text>
      </view>
    </view>
    <!-- 选择商品规格  -->
    <form wx:if="{{ specData }}" bindsubmit="onToggleTrade" report-submit>
      <button class="btn-normal" formType="submit">
        <view class='piu panel-between item-center border-t bg-w'>
          <view class='panel-start item-center'>
            <view class=' fo-32'>选择：</view>
            <view class='ma-l30 fo-32'>
              <text wx:for="{{ specData.spec_attr }}" wx:key="this">{{ item.group_name }} </text>
            </view>
          </view>
          <image src='/images/icon/right.png' class='icon-30'></image>
        </view>
      </button>
    </form>


    <!-- 规格颜色选择 S -->
    <view class='mask wrap' style='height:{{height}}px' wx:if="{{showBottomPopup}}">
      <!-- 触摸关闭 S -->
      <view class='mask-guanb' style='height:{{height-550}}px;width:100%' bindtap='onToggleTrade'></view>
      <!-- 触摸关闭 E -->
      <view class='shop-panel' id='maskd'>
        <view class='pa-40'>
          <!-- 第一行 展示商品 S -->
          <view class='panel-start'>
            <image src='{{image_path}}' bindtap="previewSkuImage" class='demo-img' mode='aspectFill'></image>
            <view class='pa-l30'>
              <view class='fo-30'>{{detail.goods_name}}</view>
              <view class='fo-28 ma-t30'>库存：{{stock_num}}</view>
              <!-- <view class='fo-28 '>已选：{{gui[guiFlag]}}/{{color[colorFlag].label}}/{{num}}件</view> -->
              <view class='fo-30 bold ma-t30 pa-t20'>￥{{goods_price}}</view>
            </view>
          </view>
          <!-- 第一行 展示商品 E -->



          <view class='ma-t30 ' style="overflow-y:scroll;height:570rpx;">

            <view class="goods-list-box" wx:if="{{detail.is_virtual != 1}}">
              <view class="cf tmall-types " wx:for="{{specData.spec_attr}}" wx:for-item="attr" wx:for-index="attr_idx" wx:key="key">
                <view class='fo-28 ma-t30'>{{attr.group_name}}</view>
                <view class='gui panel-start wrap border-b pa-b30'>
                  <view wx:for="{{attr.spec_items}}" wx:for-index="item_idx" wx:key="ikey" data-attr-idx="{{attr_idx}}" data-item-idx="{{item_idx}}" bindtap="modelTap" class='gui-item {{item.checked ? "gui-act":""}}'>{{item.spec_value}}</view>
                </view>
              </view>
            </view>
            <view wx:if="{{detail.is_virtual == 1}}">
              <view class='fo-30'>
                <view wx:if="{{detail.package.min_select < detail.package.max_select}}">请任意选择，最少选择{{detail.package.min_select}}项，最多选择{{detail.package.max_select}}项</view>
                <view wx:if="{{detail.package.max_select == detail.package.min_select}}">请任意选择{{detail.package.min_select}}项</view>
              </view>
              <!-- 虚拟商品 -->
              <view class="goods-list-box">
                <view class="cf tmall-types " wx:for="{{detail.package.data}}" wx:for-item="attr" wx:for-index="attr_idx" wx:key="{{index}}">
                  <view class='fo-28 ma-t30'>{{attr.label}}</view>
                  <view class='gui  border-b pa-b30' >
                    <view wx:for="{{attr.ch}}" wx:for-index="item_idx" data-attr='{{attr_idx}}' data-index='{{item_idx}}'  bindtap="modelTap2" class='gui-item {{item.checked ? "gui-act":""}}'>{{(item_idx+1)+'.'+item.label}}</view>
                  </view>
                </view>
              </view>
            </view>


            <!-- 数量 S -->
            <view class='fo-28 ma-t30 '>数量</view>
            <view class="selectNumber ma-t20" wx:if="{{detail.is_virtual !=1}}">
              <button bindtap="down" class="default  {{goods_num>1?'':' default-active'}}" type="default">-</button>
              <input bindinput="import" type="number" value="{{goods_num}}" disabled></input>
              <button bindtap="up" class="default" type="default">+</button>
            </view>
            <view class="fo-30 ma-t20" wx:if="{{detail.is_virtual ==1}}">
              每人限购1件商品
            </view>
            <view class='border-b ma-t30'></view>
            <!-- 数量 E -->

          </view>

          <view class='panel-center ma-t30'>
            <view class='in-cart2' wx:if="{{detail.is_virtual !=1}}" bindtap="submit" data-type="addCart">加入购物车</view>
            <view class='{{detail.is_virtual ==1?"buy-now2":"buy-now"}}' bindtap="submit" data-type="buyNow">立即购买</view>
          </view>
        </view>
      </view>
    </view>
    <!-- 规格颜色选择 E -->

    

    <!-- 商品描述 -->
    <view class="">
      <view class="top-nav m-top20 b-f b-b">
        <view class="top-nav-bar">课程描述</view>
      </view>
      <view class="order" hidden="{{hiddenOrder}}">
        <view wx:if="{{detail.content!=''}}">
          <view class="b-f goods-detail-box">
            <!-- <view class="goods-cont-li"> -->
            <template is="wxParse" data="{{wxParseData:content.nodes}}"></template>
            <!-- </view> -->
          </view>
        </view>
        <view wx:else>
          <view class="yoshop-notcont">
            <text class="iconfont icon-wushuju"></text>
            <text class="cont">亲,此处暂无详情数据</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 商品评价 -->
    <view class="goods-comment">

      <view class='piu bg-w panel-between item-center border-t' bindtap="navigateToComment">
        <view class=' fo-32'>课程评价 ({{ detail.comment_data_count }}条)</view>
        <image src='/images/icon/right.png' class='icon-30'></image>
      </view>

      <view class="goods-comment-box b-f" wx:for="{{ detail.comment_data }}" wx:key="this">
        <view class="cont-box goods-comment-box b-t b-f b-b">
          <view class="dis-flex">
            <view class="user">
              <text class="user_name f-26">{{ item.user.nickName }}</text>
            </view>
            <view class="com_xing">
              <text class="iconfont icon-shoucang active"></text>
              <block wx:if="{{ item.score < 30 }}">
                <text class="iconfont icon-shoucang active"></text>
                <text class="iconfont icon-shoucang active"></text>
              </block>
              <block wx:if="{{ item.score < 20 }}">
                <text class="iconfont icon-shoucang active"></text>
                <text class="iconfont icon-shoucang active"></text>
              </block>
            </view>
          </view>
          <view class="goods-comment-cont m-top20">
            <text class="f-26 twolist-hidden">{{ item.content }}</text>
          </view>
          <view class="f-22 col-9 m-top10">{{ item.create_time }}</view>
        </view>
      </view>
    </view>

    <!-- 底部操作栏 -->
    <view style='height:128rpx'></view>
    <view class='fix-b-1' style='{{model=="iPhone X"?"bottom:38rpx":""}}'>
      <view class='fix-panel panel-between item-center'>
        <view class='panel-start'>
          <navigator class='ryu panel-center item-center' open-type='switchTab' url='/pages/index/index'>
            <image src='/images/as.png'></image>
          </navigator>
          <button class='filter-btn ryu panel-center item-center text-center' style='border-radius:0' open-type='contact'>
            <image src='/images/as3.png' style='width:40rpx;margin-left:27rpx;margin-top:30rpx'></image>
          </button>
          <navigator class='ryu panel-center item-center' open-type='switchTab' url='/pages/flow/index'>
            <image src='/images/as2.png'></image>
          </navigator>
        </view>
        <view class='panel-end'>
          <view class='in-cart' wx:if="{{detail.is_virtual !=1}}" catchtap="onToggleTrade">加入购物车</view>
          <view class='{{detail.is_virtual ==1?"buy-now2":"buy-now"}}' catchtap="onToggleTrade">立即购买</view>
        </view>
      </view>
    </view>
    <view wx:if='{{model=="iPhone X"}}' style='position:fixed;bottom:0;height:38rpx;width:100%;background:#ffffff'></view>
    <!-- <view class="footer-fixed f-30">
     
      <view class="goods-fixed-icon dis-flex flex-x-center flex-y-center">
        <button open-type="contact" sessionFrom="weapp" size="27" style="opacity: 0;position:absolute;top:0px;left:0px;display:block;width:100%;height:100%;" type="default-light"></button>
        <text class="iconfont icon-kefu "></text>
      </view>
    
      <view bindtap="flowCart" class="goods-fixed-icon">
        <image class="flow-img" src="../../images/flow.png"></image>
        <view class="flow_num" wx:if="{{cart_total_num > 0}}">
          <text class="">{{cart_total_num}}</text>
        </view>
      </view>
      <view class="order-number" catchtap="onToggleTrade">加入购物车</view>
      <view class="order-bt" catchtap="onToggleTrade">立即购买</view>
    </view> -->

  </view>
</scroll-view>

<!-- 返回顶部 -->
<view bindtap="goTop" class="widget-goTop" wx:if="{{floorstatus}}">
  <text class="iconfont icon-fanhuidingbu"></text>
</view>

<!-- 分享按钮 -->
<zan-actionsheet show="{{ share.show }}" actions="{{ share.actions }}" cancel-text="{{ share.cancelText }}" cancel-with-mask="{{ share.cancelWithMask }}" bind:cancel="closeActionSheet" bind:actionclick="clickAction" mask-class="tiny" />

<!-- 商品海报 弹出层 -->
<zan-popup show="{{ share.showPopup }}" bindclose="togglePopup">
  <view class="pop-poster pop-example__container">
    <!-- 关闭按钮 -->
    <view class="pop-close dis-flex flex-x-center flex-y-center" bindtap="togglePopup">
      <text class="iconfont icon-shanchu f-30 col-9"></text>
    </view>
    <form bindsubmit="savePoster" report-submit="true">
      <view class="poster__image">
        <image mode="widthFix" src="{{ qrcode }}"></image>
      </view>
      <view class="poster__tips m-top10 t-c">
      </view>
      <view class="padding-box m-top10 profile-btn">
        <button formType="submit">保存图片</button>
      </view>
    </form>
  </view>
</zan-popup>

<!-- 快捷导航 -->
<!-- <shortcut id=""></shortcut> -->

<view class='fyop' wx:if="{{showQr}}">
  <view>
    <view class='panel-end ma-b10'>
      <image src='/images/gb.png' class='icon-40' bindtap='closeQr'></image>
    </view>
    <image src='/images/ds.png' style='width:630rpx;height:880rpx' class='ra-10' mode='aspectFill'></image>
    <view class='panel-between ma-t30'>
      <view class='bcbtn' bindtap='saveTup'>保存图片</view>
      <button class='sharebtn' open-type='share'>分享给好友</button>
    </view>
  </view>
</view>